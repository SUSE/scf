Upgrade notes.

0. With an older version, push 2 or 3 apps.  I go with sinatra-fibo,
go-env, and node-env.  Without services not much else will run.  We
want to make sure these apps are correctly evacuated and repushed after
upgrading to the new version.

cd .../hcf-infrastructure/upgrades

X= # 125 or 126
Y=
Z=
IP=15.$X.$Y.$Z


bash -ex cf-run.bash $IP
cd $HOME/lab/stackato/stackato-samples/sinatra-fibo
cf push fibo
cd ~/git/Stackato-Apps/go-env/
cf push goenv
cd ../node-env
cf push nodenv

1. Manually fix consul:

Upload a newer hcf-config.tar.gz to /tmp/hcf-config.tar.gz

scp /home/ericp/git/hpcloud/hcf-infrastructure/terraform-scripts/hcf/hcf-config-cf-v222.tar.gz ${IP}:

Server:

Run: bash /opt/hcf/bin/consullin.bash http://`/opt/hcf/bin/get_ip`:8501 /tmp/hcf-config.tar.gz

2. Add new key/values to consul
See upgrade-v222.bash 

scp ~/lab/hcf/notes/upgrade-v222.bash ${IP}:

And run on the server

To make this step easier it's important to not bury these changes in the
terraform script.

3. Copy role-dependencies.yml from 

scp ~/lab/hcf/role-dependencies.yml ${IP}:

4. Allow access to the other docker registry:
sudo vi /etc/default/docker
* Add another entry --insecure-registry=15.125...
sudo service docker restart

5.  run ruby upgrade-versions.rb -t 222 -g latest-epdev -r 15.125.71.0:5000 -d ~/role-dependencies.yml 



